# ä»»åŠ¡14ï¼šç§¯åˆ†ç®¡ç†API - å®Œæˆæ€»ç»“

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

å®ç°å®Œæ•´çš„ç§¯åˆ†ç®¡ç†ç³»ç»ŸAPIï¼ŒåŒ…æ‹¬ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢ã€ç§¯åˆ†è·å–ã€ç§¯åˆ†æ¶ˆè€—ã€ç§¯åˆ†å•†åŸã€æ¯æ—¥ä»»åŠ¡ã€ç”¨æˆ·ç­‰çº§ç³»ç»Ÿä»¥åŠç®¡ç†å‘˜ç§¯åˆ†ç®¡ç†åŠŸèƒ½ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯æ¥å£ (14.1)

**æ¥å£:** `GET /api/v1/points/my-info`

**åŠŸèƒ½:**
- è¿”å›ç”¨æˆ·ç§¯åˆ†ä½™é¢
- è¿”å›ç´¯è®¡ç§¯åˆ†
- è¿”å›ç”¨æˆ·ç­‰çº§ä¿¡æ¯
- è¿”å›ç­‰çº§åç§°å’Œç‰¹æƒåˆ—è¡¨
- è¿”å›ä¸‹ä¸€ç­‰çº§æ‰€éœ€ç§¯åˆ†

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - getUserPointsInfo()
- `backend/src/controllers/pointsController.ts` - getMyPointsInfo()

### 2. ç§¯åˆ†æ˜ç»†æ¥å£ (14.2)

**æ¥å£:** `GET /api/v1/points/records`

**åŠŸèƒ½:**
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- æ”¯æŒæŒ‰ç±»å‹ç­›é€‰ï¼ˆè·å¾—/æ¶ˆè€—/å…‘æ¢/å……å€¼ï¼‰
- æ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰
- è¿”å›ç§¯åˆ†å˜åŠ¨è®°å½•
- è¿”å›ç§¯åˆ†ç»Ÿè®¡ï¼ˆæ€»è·å¾—ã€æ€»æ¶ˆè€—ã€å½“å‰ä½™é¢ï¼‰

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - getPointsRecords()
- `backend/src/controllers/pointsController.ts` - getPointsRecords()

### 3. ç§¯åˆ†è·å–æœåŠ¡ (14.3)

**åŠŸèƒ½:**
- âœ… ä¸Šä¼ ä½œå“å®¡æ ¸é€šè¿‡: +50ç§¯åˆ†
- âœ… ä½œå“è¢«ä¸‹è½½: +2ç§¯åˆ†
- âœ… ä½œå“è¢«æ”¶è—: +5ç§¯åˆ†
- âœ… ä½œå“è¢«ç‚¹èµ: +1ç§¯åˆ†
- âœ… æ¯æ—¥ç­¾åˆ°: +10ç§¯åˆ†
- âœ… å®Œå–„ä¸ªäººèµ„æ–™: +20ç§¯åˆ†ï¼ˆä¸€æ¬¡æ€§ï¼‰
- âœ… ç»‘å®šé‚®ç®±: +10ç§¯åˆ†ï¼ˆä¸€æ¬¡æ€§ï¼‰
- âœ… ç»‘å®šå¾®ä¿¡: +10ç§¯åˆ†ï¼ˆä¸€æ¬¡æ€§ï¼‰
- âœ… é‚€è¯·æ–°ç”¨æˆ·: +30ç§¯åˆ†
- âœ… è‡ªåŠ¨è®°å½•ç§¯åˆ†æ˜ç»†
- âœ… ç­‰çº§æå‡é€šçŸ¥

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - å„ç§award*å‡½æ•°

### 4. ç§¯åˆ†æ¶ˆè€—æœåŠ¡ (14.4)

**åŠŸèƒ½:**
- âœ… ä¸‹è½½æ™®é€šèµ„æº: -10ç§¯åˆ†
- âœ… ä¸‹è½½é«˜çº§èµ„æº: -20ç§¯åˆ†
- âœ… ä¸‹è½½ç²¾å“èµ„æº: -50ç§¯åˆ†
- âœ… VIPç”¨æˆ·ä¸‹è½½ä¸æ¶ˆè€—ç§¯åˆ†
- âœ… ç”¨æˆ·ç­‰çº§æŠ˜æ‰£ï¼ˆLV2-LV6äº«å—5%-30%æŠ˜æ‰£ï¼‰
- âœ… ç§¯åˆ†ä¸è¶³æ—¶æç¤ºå¹¶é˜»æ­¢ä¸‹è½½
- âœ… è‡ªåŠ¨è®°å½•ç§¯åˆ†æ˜ç»†

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - consumeDownloadPoints()

### 5. ç§¯åˆ†å•†åŸæ¥å£ (14.5)

**æ¥å£:**
- `GET /api/v1/points/products` - è·å–å•†å“åˆ—è¡¨
- `POST /api/v1/points/exchange` - å…‘æ¢å•†å“
- `GET /api/v1/points/exchange-records` - è·å–å…‘æ¢è®°å½•

**åŠŸèƒ½:**
- âœ… æ”¯æŒå…‘æ¢VIPä¼šå‘˜
- âœ… æ”¯æŒå…‘æ¢ä¸‹è½½æ¬¡æ•°åŒ…
- âœ… æ”¯æŒå…‘æ¢å®ç‰©å•†å“
- âœ… æ£€æŸ¥ç§¯åˆ†ä½™é¢
- âœ… æ‰£é™¤ç§¯åˆ†å¹¶å‘æ”¾å•†å“/æƒç›Š
- âœ… å®ç‰©å•†å“è¦æ±‚å¡«å†™æ”¶è´§åœ°å€
- âœ… è‡ªåŠ¨è®°å½•å…‘æ¢è®°å½•
- âœ… VIPå•†å“è‡ªåŠ¨å¼€é€šVIP

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - getPointsProducts(), exchangePointsProduct(), getUserExchangeRecords()
- `backend/src/controllers/pointsController.ts` - ç›¸å…³æ§åˆ¶å™¨æ–¹æ³•

### 6. ç§¯åˆ†å……å€¼æ¥å£ (14.6)

**æ¥å£:**
- `GET /api/v1/points/recharge-packages` - è·å–å……å€¼å¥—é¤
- `POST /api/v1/points/recharge` - åˆ›å»ºå……å€¼è®¢å•

**åŠŸèƒ½:**
- âœ… æ”¯æŒå¤šç§å……å€¼å¥—é¤ï¼ˆ100/500/1000/5000ç§¯åˆ†ï¼‰
- âœ… ä¸åŒå¥—é¤äº«å—ä¸åŒæŠ˜æ‰£ï¼ˆ9æŠ˜-7æŠ˜ï¼‰
- âœ… åˆ›å»ºå……å€¼è®¢å•
- âœ… æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨å……å€¼ç§¯åˆ†

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - getRechargePackages(), createRechargeOrder(), processRecharge()
- `backend/src/controllers/pointsController.ts` - ç›¸å…³æ§åˆ¶å™¨æ–¹æ³•

### 7. æ¯æ—¥ä»»åŠ¡æ¥å£ (14.7)

**æ¥å£:**
- `GET /api/v1/points/daily-tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `POST /api/v1/points/daily-tasks/:taskCode/complete` - å®Œæˆä»»åŠ¡
- `POST /api/v1/points/signin` - æ¯æ—¥ç­¾åˆ°

**åŠŸèƒ½:**
- âœ… æ”¯æŒæ¯æ—¥ç­¾åˆ°ä»»åŠ¡
- âœ… æ”¯æŒä¸Šä¼ ä½œå“ä»»åŠ¡
- âœ… æ”¯æŒä¸‹è½½èµ„æºä»»åŠ¡
- âœ… æ”¯æŒæ”¶è—ä½œå“ä»»åŠ¡
- âœ… æ”¯æŒåˆ†äº«ä½œå“ä»»åŠ¡
- âœ… å®Œæˆä»»åŠ¡è‡ªåŠ¨å‘æ”¾ç§¯åˆ†
- âœ… å®Œæˆæ‰€æœ‰æ¯æ—¥ä»»åŠ¡é¢å¤–å¥–åŠ±+20ç§¯åˆ†
- âœ… ä»»åŠ¡è¿›åº¦è·Ÿè¸ª
- âœ… æ¯æ—¥è‡ªåŠ¨é‡ç½®

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - getDailyTasks(), completeTask(), dailySignin()
- `backend/src/controllers/pointsController.ts` - ç›¸å…³æ§åˆ¶å™¨æ–¹æ³•

### 8. ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ (14.8)

**ç­‰çº§é…ç½®:**
- LV1 æ–°æ‰‹: 0-499ç§¯åˆ†
- LV2 åˆçº§: 500-1999ç§¯åˆ†ï¼ˆä¸‹è½½-5%ç§¯åˆ†ï¼‰
- LV3 ä¸­çº§: 2000-4999ç§¯åˆ†ï¼ˆä¸‹è½½-10%ç§¯åˆ†ï¼Œä¸“å±å¾½ç« ï¼‰
- LV4 é«˜çº§: 5000-9999ç§¯åˆ†ï¼ˆä¸‹è½½-15%ç§¯åˆ†ï¼Œä½œå“ä¼˜å…ˆå±•ç¤ºï¼‰
- LV5 ä¸“å®¶: 10000-19999ç§¯åˆ†ï¼ˆä¸‹è½½-20%ç§¯åˆ†ï¼Œä¸“å±å®¢æœï¼‰
- LV6 å¤§å¸ˆ: 20000+ç§¯åˆ†ï¼ˆä¸‹è½½-30%ç§¯åˆ†ï¼Œæ‰€æœ‰ç‰¹æƒï¼‰

**åŠŸèƒ½:**
- âœ… æ ¹æ®ç´¯è®¡ç§¯åˆ†è‡ªåŠ¨è®¡ç®—ç”¨æˆ·ç­‰çº§
- âœ… ç­‰çº§æå‡æ—¶å‘é€é€šçŸ¥ï¼ˆæ§åˆ¶å°æ—¥å¿—ï¼‰
- âœ… è§£é”å¯¹åº”ç­‰çº§ç‰¹æƒ
- âœ… ä¸‹è½½èµ„æºäº«å—ç­‰çº§æŠ˜æ‰£

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - calculateUserLevel(), handleLevelUp(), getUserLevelPrivileges()

### 9. ç§¯åˆ†ç®¡ç†æ¥å£ï¼ˆç®¡ç†å‘˜ï¼‰(14.9)

**æ¥å£:**
- `GET /api/v1/admin/points/rules` - è·å–ç§¯åˆ†è§„åˆ™
- `PUT /api/v1/admin/points/rules/:ruleId` - æ›´æ–°ç§¯åˆ†è§„åˆ™
- `GET /api/v1/admin/points/products` - è·å–å•†åŸå•†å“
- `POST /api/v1/admin/points/products` - æ·»åŠ å•†å“
- `PUT /api/v1/admin/points/products/:productId` - ç¼–è¾‘å•†å“
- `DELETE /api/v1/admin/points/products/:productId` - åˆ é™¤å•†å“
- `GET /api/v1/admin/points/exchange-records` - è·å–å…‘æ¢è®°å½•
- `PUT /api/v1/admin/points/exchange-records/:exchangeId/ship` - å‘è´§
- `GET /api/v1/admin/points/statistics` - ç§¯åˆ†ç»Ÿè®¡
- `POST /api/v1/admin/users/:userId/points/adjust` - æ‰‹åŠ¨è°ƒæ•´ç”¨æˆ·ç§¯åˆ†

**åŠŸèƒ½:**
- âœ… ç®¡ç†ç§¯åˆ†è§„åˆ™ï¼ˆæŸ¥çœ‹ã€ä¿®æ”¹ã€å¯ç”¨/ç¦ç”¨ï¼‰
- âœ… ç®¡ç†ç§¯åˆ†å•†å“ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- âœ… ç®¡ç†å…‘æ¢è®°å½•ï¼ˆæŸ¥çœ‹ã€å‘è´§ï¼‰
- âœ… æŸ¥çœ‹ç§¯åˆ†ç»Ÿè®¡æ•°æ®
- âœ… æ‰‹åŠ¨è°ƒæ•´ç”¨æˆ·ç§¯åˆ†ï¼ˆéœ€å¡«å†™åŸå› ï¼‰
- âœ… æƒé™éªŒè¯ï¼ˆéœ€è¦ç›¸åº”ç®¡ç†æƒé™ï¼‰

**å®ç°æ–‡ä»¶:**
- `backend/src/services/pointsService.ts` - ç®¡ç†å‘˜ç›¸å…³å‡½æ•°
- `backend/src/controllers/adminPointsController.ts` - ç®¡ç†å‘˜æ§åˆ¶å™¨
- `backend/src/routes/adminPoints.ts` - ç®¡ç†å‘˜è·¯ç”±
- `backend/src/routes/adminUsers.ts` - ç”¨æˆ·ç§¯åˆ†è°ƒæ•´è·¯ç”±

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### æœåŠ¡å±‚
- `backend/src/services/pointsService.ts` - ç§¯åˆ†æœåŠ¡ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰

### æ§åˆ¶å™¨å±‚
- `backend/src/controllers/pointsController.ts` - ç”¨æˆ·ç§¯åˆ†æ§åˆ¶å™¨
- `backend/src/controllers/adminPointsController.ts` - ç®¡ç†å‘˜ç§¯åˆ†æ§åˆ¶å™¨

### è·¯ç”±å±‚
- `backend/src/routes/points.ts` - ç”¨æˆ·ç§¯åˆ†è·¯ç”±
- `backend/src/routes/adminPoints.ts` - ç®¡ç†å‘˜ç§¯åˆ†è·¯ç”±
- `backend/src/routes/adminUsers.ts` - ç®¡ç†å‘˜ç”¨æˆ·è·¯ç”±

### æµ‹è¯•æ–‡ä»¶
- `backend/src/test-points-api.ts` - ç§¯åˆ†APIæµ‹è¯•è„šæœ¬

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

- `backend/src/app.ts` - æ³¨å†Œç§¯åˆ†è·¯ç”±

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. ç§¯åˆ†è·å–æœºåˆ¶
- å¤šç§ç§¯åˆ†è·å–é€”å¾„
- ä¸€æ¬¡æ€§å¥–åŠ±é˜²é‡å¤
- è‡ªåŠ¨è®°å½•ç§¯åˆ†æ˜ç»†
- ç­‰çº§æå‡è‡ªåŠ¨é€šçŸ¥

### 2. ç§¯åˆ†æ¶ˆè€—æœºåˆ¶
- VIPç”¨æˆ·å…è´¹ä¸‹è½½
- ç”¨æˆ·ç­‰çº§æŠ˜æ‰£
- ç§¯åˆ†ä¸è¶³æ‹¦æˆª
- è‡ªåŠ¨è®°å½•æ¶ˆè€—æ˜ç»†

### 3. ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ
- 6ä¸ªç­‰çº§æ¢¯åº¦
- è‡ªåŠ¨ç­‰çº§è®¡ç®—
- ç­‰çº§ç‰¹æƒè§£é”
- ä¸‹è½½æŠ˜æ‰£é€’å¢

### 4. æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿ
- ä»»åŠ¡è¿›åº¦è·Ÿè¸ª
- æ¯æ—¥è‡ªåŠ¨é‡ç½®
- å®Œæˆå¥–åŠ±å‘æ”¾
- å…¨éƒ¨å®Œæˆé¢å¤–å¥–åŠ±

### 5. ç§¯åˆ†å•†åŸ
- VIPä¼šå‘˜å…‘æ¢
- ä¸‹è½½æ¬¡æ•°åŒ…
- å®ç‰©å•†å“å…‘æ¢
- è‡ªåŠ¨å‘æ”¾æƒç›Š

### 6. ç®¡ç†å‘˜åŠŸèƒ½
- ç§¯åˆ†è§„åˆ™ç®¡ç†
- å•†å“ç®¡ç†
- å…‘æ¢è®°å½•ç®¡ç†
- ç§¯åˆ†ç»Ÿè®¡åˆ†æ
- æ‰‹åŠ¨è°ƒæ•´ç§¯åˆ†

## ğŸ“Š æ•°æ®åº“è¡¨

ä½¿ç”¨çš„æ•°æ®åº“è¡¨ï¼š
- `users` - ç”¨æˆ·è¡¨ï¼ˆç§¯åˆ†ä½™é¢ã€ç´¯è®¡ç§¯åˆ†ã€ç”¨æˆ·ç­‰çº§ï¼‰
- `points_rules` - ç§¯åˆ†è§„åˆ™è¡¨
- `points_records` - ç§¯åˆ†è®°å½•è¡¨
- `points_products` - ç§¯åˆ†å•†å“è¡¨
- `points_exchange_records` - ç§¯åˆ†å…‘æ¢è®°å½•è¡¨
- `daily_tasks` - æ¯æ—¥ä»»åŠ¡è¡¨
- `user_tasks` - ç”¨æˆ·ä»»åŠ¡å®Œæˆè®°å½•è¡¨
- `orders` - è®¢å•è¡¨ï¼ˆç§¯åˆ†å……å€¼è®¢å•ï¼‰

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
npm run dev
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
npx tsx src/test-points-api.ts
```

### 3. æ‰‹åŠ¨æµ‹è¯•

ä½¿ç”¨Postmanæˆ–å…¶ä»–APIæµ‹è¯•å·¥å…·æµ‹è¯•ä»¥ä¸‹æ¥å£ï¼š

**ç”¨æˆ·æ¥å£:**
- GET /api/v1/points/my-info
- GET /api/v1/points/records
- POST /api/v1/points/signin
- GET /api/v1/points/daily-tasks
- GET /api/v1/points/products
- POST /api/v1/points/exchange
- GET /api/v1/points/recharge-packages

**ç®¡ç†å‘˜æ¥å£:**
- GET /api/v1/admin/points/rules
- PUT /api/v1/admin/points/rules/:ruleId
- GET /api/v1/admin/points/products
- POST /api/v1/admin/points/products
- GET /api/v1/admin/points/statistics
- POST /api/v1/admin/users/:userId/points/adjust

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æƒé™éªŒè¯**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç™»å½•ï¼Œç®¡ç†å‘˜æ¥å£éœ€è¦ç›¸åº”æƒé™
2. **ç§¯åˆ†è§„åˆ™**: ç§¯åˆ†è§„åˆ™å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¯é€šè¿‡ç®¡ç†å‘˜æ¥å£åŠ¨æ€è°ƒæ•´
3. **ç­‰çº§è®¡ç®—**: ç”¨æˆ·ç­‰çº§åŸºäºç´¯è®¡ç§¯åˆ†è‡ªåŠ¨è®¡ç®—ï¼Œä¸å¯æ‰‹åŠ¨è®¾ç½®
4. **VIPç‰¹æƒ**: VIPç”¨æˆ·ä¸‹è½½èµ„æºä¸æ¶ˆè€—ç§¯åˆ†
5. **ç­‰çº§æŠ˜æ‰£**: æ™®é€šç”¨æˆ·æ ¹æ®ç­‰çº§äº«å—ä¸‹è½½æŠ˜æ‰£
6. **ä»»åŠ¡é‡ç½®**: æ¯æ—¥ä»»åŠ¡æ¯å¤©0ç‚¹è‡ªåŠ¨é‡ç½®
7. **ä¸€æ¬¡æ€§å¥–åŠ±**: æŸäº›å¥–åŠ±ï¼ˆå¦‚å®Œå–„èµ„æ–™ï¼‰åªèƒ½è·å¾—ä¸€æ¬¡

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **é€šçŸ¥ç³»ç»Ÿ**: å®ç°å®Œæ•´çš„é€šçŸ¥ç³»ç»Ÿï¼ˆç«™å†…é€šçŸ¥ã€é‚®ä»¶ã€çŸ­ä¿¡ï¼‰
2. **ç§¯åˆ†å•†åŸ**: æ·»åŠ æ›´å¤šå•†å“ç±»å‹å’Œå…‘æ¢é€‰é¡¹
3. **ä»»åŠ¡ç³»ç»Ÿ**: æ·»åŠ å‘¨ä»»åŠ¡ã€æœˆä»»åŠ¡ç­‰æ›´å¤šä»»åŠ¡ç±»å‹
4. **ç§¯åˆ†æ´»åŠ¨**: å®ç°ç§¯åˆ†ç¿»å€ã€é™æ—¶æ´»åŠ¨ç­‰è¿è¥åŠŸèƒ½
5. **ç§¯åˆ†è½¬èµ **: å®ç°ç”¨æˆ·ä¹‹é—´ç§¯åˆ†è½¬èµ åŠŸèƒ½
6. **ç§¯åˆ†æ’è¡Œæ¦œ**: å®ç°ç§¯åˆ†æ’è¡Œæ¦œåŠŸèƒ½
7. **ç§¯åˆ†è¿‡æœŸ**: å®ç°ç§¯åˆ†è¿‡æœŸæœºåˆ¶
8. **ç§¯åˆ†å†»ç»“**: å®ç°ç§¯åˆ†å†»ç»“/è§£å†»åŠŸèƒ½

## âœ… ä»»åŠ¡å®ŒæˆçŠ¶æ€

- [x] 14.1 å®ç°è·å–ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯æ¥å£
- [x] 14.2 å®ç°è·å–ç§¯åˆ†æ˜ç»†æ¥å£
- [x] 14.3 å®ç°ç§¯åˆ†è·å–æœåŠ¡
- [x] 14.4 å®ç°ç§¯åˆ†æ¶ˆè€—æœåŠ¡
- [x] 14.5 å®ç°ç§¯åˆ†å•†åŸæ¥å£
- [x] 14.6 å®ç°ç§¯åˆ†å……å€¼æ¥å£
- [x] 14.7 å®ç°æ¯æ—¥ä»»åŠ¡æ¥å£
- [x] 14.8 å®ç°ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ
- [x] 14.9 å®ç°ç§¯åˆ†ç®¡ç†æ¥å£(ç®¡ç†å‘˜)

## ğŸ“… å®Œæˆæ—¶é—´

2024å¹´12æœˆ21æ—¥

---

**ä»»åŠ¡14ï¼šç§¯åˆ†ç®¡ç†API - å…¨éƒ¨å®Œæˆï¼** âœ…
