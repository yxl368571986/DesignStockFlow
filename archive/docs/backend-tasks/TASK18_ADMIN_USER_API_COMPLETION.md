# ä»»åŠ¡18å®ŒæˆæŠ¥å‘Šï¼šç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†API

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

å®ç°å®Œæ•´çš„ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†APIï¼ŒåŒ…æ‹¬ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢ã€ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹ã€ç”¨æˆ·çŠ¶æ€ç®¡ç†ã€å¯†ç é‡ç½®ã€VIPè°ƒæ•´å’Œç§¯åˆ†è°ƒæ•´ç­‰åŠŸèƒ½ã€‚

## âœ… å®Œæˆçš„åŠŸèƒ½

### 1. ç”¨æˆ·åˆ—è¡¨ç®¡ç† (18.1)
- âœ… GET /api/v1/admin/users - è·å–ç”¨æˆ·åˆ—è¡¨
- âœ… æ”¯æŒåˆ†é¡µï¼ˆpage, page_sizeï¼‰
- âœ… æ”¯æŒæœç´¢ï¼ˆæ‰‹æœºå·/æ˜µç§°/ç”¨æˆ·IDï¼‰
- âœ… æ”¯æŒç­›é€‰ï¼ˆVIPç­‰çº§/çŠ¶æ€ï¼‰
- âœ… è¿”å›ç”¨æˆ·å®Œæ•´ä¿¡æ¯ï¼ˆVIPä¿¡æ¯ã€ç§¯åˆ†ä½™é¢ã€ç”¨æˆ·ç­‰çº§ï¼‰

### 2. ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹ (18.2)
- âœ… GET /api/v1/admin/users/:userId - è·å–ç”¨æˆ·è¯¦æƒ…
- âœ… è¿”å›ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- âœ… è¿”å›ç§¯åˆ†æ˜ç»†ï¼ˆæœ€è¿‘20æ¡ï¼‰
- âœ… è¿”å›æ“ä½œè®°å½•ï¼ˆæœ€è¿‘20æ¡ï¼‰

### 3. ç”¨æˆ·çŠ¶æ€ç®¡ç† (18.3)
- âœ… PUT /api/v1/admin/users/:userId/status - ç¦ç”¨/å¯ç”¨ç”¨æˆ·
- âœ… æ”¯æŒç¦ç”¨ç”¨æˆ·ï¼ˆstatus=0ï¼‰
- âœ… æ”¯æŒå¯ç”¨ç”¨æˆ·ï¼ˆstatus=1ï¼‰
- âœ… ç¦ç”¨åé˜»æ­¢ç”¨æˆ·ç™»å½•
- âœ… è®°å½•æ“ä½œæ—¥å¿—
- âœ… é˜²æ­¢ç®¡ç†å‘˜ç¦ç”¨è‡ªå·±

### 4. å¯†ç é‡ç½® (18.4)
- âœ… POST /api/v1/admin/users/:userId/reset-password - é‡ç½®ç”¨æˆ·å¯†ç 
- âœ… ç”Ÿæˆ8ä½éšæœºä¸´æ—¶å¯†ç 
- âœ… ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
- âœ… è®°å½•æ“ä½œæ—¥å¿—
- âœ… è¿”å›ä¸´æ—¶å¯†ç ç»™ç®¡ç†å‘˜

### 5. VIPè°ƒæ•´ (18.5)
- âœ… PUT /api/v1/admin/users/:userId/vip - è°ƒæ•´ç”¨æˆ·VIP
- âœ… æ”¯æŒè®¾ç½®VIPç­‰çº§ï¼ˆ0-3ï¼‰
- âœ… æ”¯æŒè®¾ç½®VIPåˆ°æœŸæ—¶é—´
- âœ… éªŒè¯VIPç­‰çº§å’Œåˆ°æœŸæ—¶é—´çš„åˆæ³•æ€§
- âœ… è®°å½•æ“ä½œæ—¥å¿—

### 6. ç§¯åˆ†è°ƒæ•´ (18.6)
- âœ… POST /api/v1/admin/users/:userId/points/adjust - è°ƒæ•´ç”¨æˆ·ç§¯åˆ†
- âœ… æ”¯æŒå¢åŠ ç§¯åˆ†ï¼ˆæ­£æ•°ï¼‰
- âœ… æ”¯æŒæ‰£å‡ç§¯åˆ†ï¼ˆè´Ÿæ•°ï¼‰
- âœ… éªŒè¯ç§¯åˆ†ä½™é¢ä¸ä¸ºè´Ÿ
- âœ… è¦æ±‚è¾“å…¥è°ƒæ•´åŸå› 
- âœ… è®°å½•ç§¯åˆ†æ˜ç»†
- âœ… è®°å½•æ“ä½œæ—¥å¿—

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

### æ–°å¢è¡¨
- **admin_operation_logs** - ç®¡ç†å‘˜æ“ä½œæ—¥å¿—è¡¨
  - log_id (ä¸»é”®)
  - operator_id (æ“ä½œè€…ID)
  - target_user_id (ç›®æ ‡ç”¨æˆ·ID)
  - action (æ“ä½œç±»å‹)
  - description (æ“ä½œæè¿°)
  - created_at (åˆ›å»ºæ—¶é—´)

### è¿ç§»æ–‡ä»¶
- `20251221135234_add_admin_operation_log` - æ·»åŠ ç®¡ç†å‘˜æ“ä½œæ—¥å¿—è¡¨

## ğŸ“ æ–°å¢æ–‡ä»¶

### æ§åˆ¶å™¨
- `backend/src/controllers/adminUserController.ts` - ç®¡ç†å‘˜ç”¨æˆ·æ§åˆ¶å™¨
  - getUserList() - è·å–ç”¨æˆ·åˆ—è¡¨
  - getUserDetail() - è·å–ç”¨æˆ·è¯¦æƒ…
  - updateUserStatus() - æ›´æ–°ç”¨æˆ·çŠ¶æ€
  - resetPassword() - é‡ç½®å¯†ç 
  - adjustVip() - è°ƒæ•´VIP
  - adjustPoints() - è°ƒæ•´ç§¯åˆ†

### æœåŠ¡å±‚
- `backend/src/services/adminUserService.ts` - ç®¡ç†å‘˜ç”¨æˆ·æœåŠ¡
  - getUserList() - ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢ï¼ˆæ”¯æŒæœç´¢å’Œç­›é€‰ï¼‰
  - getUserDetail() - ç”¨æˆ·è¯¦æƒ…æŸ¥è¯¢ï¼ˆåŒ…å«ç§¯åˆ†æ˜ç»†å’Œæ“ä½œè®°å½•ï¼‰
  - updateUserStatus() - ç”¨æˆ·çŠ¶æ€æ›´æ–°
  - resetPassword() - å¯†ç é‡ç½®ï¼ˆç”Ÿæˆä¸´æ—¶å¯†ç ï¼‰
  - adjustVip() - VIPè°ƒæ•´
  - adjustPoints() - ç§¯åˆ†è°ƒæ•´
  - createOperationLog() - åˆ›å»ºæ“ä½œæ—¥å¿—
  - generateTempPassword() - ç”Ÿæˆä¸´æ—¶å¯†ç 

### è·¯ç”±
- `backend/src/routes/adminUsers.ts` - ç®¡ç†å‘˜ç”¨æˆ·è·¯ç”±
  - æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯
  - ä½¿ç”¨æƒé™ä¸­é—´ä»¶æ§åˆ¶è®¿é—®

### æµ‹è¯•æ–‡ä»¶
- `backend/src/test-admin-user-api.ts` - å®Œæ•´çš„APIæµ‹è¯•è„šæœ¬
  - 12ä¸ªæµ‹è¯•ç”¨ä¾‹
  - è¦†ç›–æ‰€æœ‰åŠŸèƒ½ç‚¹

### å·¥å…·è„šæœ¬
- `backend/check-user.ts` - æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯å’Œå¯†ç 
- `backend/update-passwords.ts` - æ‰¹é‡æ›´æ–°ç”¨æˆ·å¯†ç 

## ğŸ” æƒé™æ§åˆ¶

æ‰€æœ‰ç®¡ç†å‘˜ç”¨æˆ·APIéƒ½éœ€è¦ä»¥ä¸‹æƒé™ï¼š

| æ¥å£ | æ‰€éœ€æƒé™ |
|------|---------|
| è·å–ç”¨æˆ·åˆ—è¡¨ | user:view |
| è·å–ç”¨æˆ·è¯¦æƒ… | user:view |
| ç¦ç”¨/å¯ç”¨ç”¨æˆ· | user:disable |
| é‡ç½®å¯†ç  | user:edit |
| è°ƒæ•´VIP | user:edit |
| è°ƒæ•´ç§¯åˆ† | user:edit |

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•ç»Ÿè®¡
- **æ€»æµ‹è¯•æ•°**: 12
- **é€šè¿‡**: 12 âœ…
- **å¤±è´¥**: 0 âŒ
- **æˆåŠŸç‡**: 100.00%

### æµ‹è¯•ç”¨ä¾‹
1. âœ… ç®¡ç†å‘˜ç™»å½•
2. âœ… è·å–ç”¨æˆ·åˆ—è¡¨
3. âœ… æœç´¢ç”¨æˆ·
4. âœ… ç­›é€‰VIPç”¨æˆ·
5. âœ… è·å–ç”¨æˆ·è¯¦æƒ…
6. âœ… ç¦ç”¨ç”¨æˆ·
7. âœ… å¯ç”¨ç”¨æˆ·
8. âœ… é‡ç½®ç”¨æˆ·å¯†ç 
9. âœ… è°ƒæ•´ç”¨æˆ·VIP
10. âœ… å¢åŠ ç”¨æˆ·ç§¯åˆ†
11. âœ… æ‰£å‡ç”¨æˆ·ç§¯åˆ†
12. âœ… éªŒè¯æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“ APIæ¥å£æ–‡æ¡£

### 1. è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /api/v1/admin/users
Authorization: Bearer {token}

Query Parameters:
- page: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- page_size: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- search: æœç´¢å…³é”®è¯ï¼ˆæ‰‹æœºå·/æ˜µç§°/ç”¨æˆ·IDï¼‰
- vip_level: VIPç­‰çº§ç­›é€‰
- status: çŠ¶æ€ç­›é€‰ï¼ˆ1=æ­£å¸¸ï¼Œ0=ç¦ç”¨ï¼‰

Response:
{
  "code": 200,
  "data": {
    "list": [...],
    "total": 4,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1
  }
}
```

### 2. è·å–ç”¨æˆ·è¯¦æƒ…
```http
GET /api/v1/admin/users/:userId
Authorization: Bearer {token}

Response:
{
  "code": 200,
  "data": {
    "userId": "...",
    "phone": "...",
    "nickname": "...",
    "pointsRecords": [...],
    "operationLogs": [...]
  }
}
```

### 3. ç¦ç”¨/å¯ç”¨ç”¨æˆ·
```http
PUT /api/v1/admin/users/:userId/status
Authorization: Bearer {token}

Body:
{
  "status": 0,  // 0=ç¦ç”¨ï¼Œ1=å¯ç”¨
  "reason": "è¿è§„æ“ä½œ"
}
```

### 4. é‡ç½®å¯†ç 
```http
POST /api/v1/admin/users/:userId/reset-password
Authorization: Bearer {token}

Response:
{
  "code": 200,
  "data": {
    "tempPassword": "66pP8z6X"
  }
}
```

### 5. è°ƒæ•´VIP
```http
PUT /api/v1/admin/users/:userId/vip
Authorization: Bearer {token}

Body:
{
  "vip_level": 1,
  "vip_expire_at": "2026-01-20T14:01:50.105Z",
  "reason": "æ´»åŠ¨èµ é€"
}
```

### 6. è°ƒæ•´ç§¯åˆ†
```http
POST /api/v1/admin/users/:userId/points/adjust
Authorization: Bearer {token}

Body:
{
  "points_change": 100,  // æ­£æ•°=å¢åŠ ï¼Œè´Ÿæ•°=æ‰£å‡
  "reason": "æ´»åŠ¨å¥–åŠ±"
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å­—æ®µåè½¬æ¢
- æ•°æ®åº“ä½¿ç”¨ snake_caseï¼ˆuser_id, created_atï¼‰
- APIä½¿ç”¨ camelCaseï¼ˆuserId, createdAtï¼‰
- é€šè¿‡ä¸­é—´ä»¶è‡ªåŠ¨è½¬æ¢

### å¯†ç å®‰å…¨
- ä½¿ç”¨bcryptåŠ å¯†ï¼ˆ10è½®ï¼‰
- ä¸´æ—¶å¯†ç éšæœºç”Ÿæˆï¼ˆ8ä½å­—ç¬¦ï¼‰
- é¿å…ä½¿ç”¨æ˜“æ··æ·†å­—ç¬¦ï¼ˆ0, O, I, lç­‰ï¼‰

### æ“ä½œæ—¥å¿—
- æ‰€æœ‰ç®¡ç†æ“ä½œéƒ½è®°å½•æ—¥å¿—
- åŒ…å«æ“ä½œè€…ã€ç›®æ ‡ç”¨æˆ·ã€æ“ä½œç±»å‹ã€æè¿°
- æ”¯æŒå®¡è®¡è¿½è¸ª

### æ•°æ®éªŒè¯
- VIPç­‰çº§èŒƒå›´éªŒè¯ï¼ˆ0-3ï¼‰
- ç§¯åˆ†ä½™é¢éè´ŸéªŒè¯
- é˜²æ­¢ç®¡ç†å‘˜ç¦ç”¨è‡ªå·±
- å¿…å¡«å­—æ®µéªŒè¯

## ğŸ› é—®é¢˜ä¿®å¤

### 1. å¯†ç åŠ å¯†é—®é¢˜
- **é—®é¢˜**: seedè„šæœ¬ä¸­å¯†ç æœªåŠ å¯†
- **è§£å†³**: æ›´æ–°seed.tsä½¿ç”¨bcryptåŠ å¯†
- **å½±å“**: æ‰€æœ‰æµ‹è¯•è´¦å·

### 2. Prismaæ¨¡å‹åç§°é—®é¢˜
- **é—®é¢˜**: ä½¿ç”¨äº†snake_caseæ¨¡å‹åï¼ˆadmin_operation_logï¼‰
- **è§£å†³**: æ”¹ç”¨é©¼å³°å‘½åï¼ˆadminOperationLogï¼‰
- **å½±å“**: æ“ä½œæ—¥å¿—å’Œç§¯åˆ†è®°å½•æŸ¥è¯¢

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ–°å¢æ–‡ä»¶**: 6ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 3ä¸ª
- **æ–°å¢ä»£ç è¡Œæ•°**: ~800è¡Œ
- **æµ‹è¯•è¦†ç›–ç‡**: 100%

## ğŸ¯ ä¸‹ä¸€æ­¥

ä»»åŠ¡18å·²å®Œæˆï¼Œå¯ä»¥ç»§ç»­ä»¥ä¸‹ä»»åŠ¡ï¼š
- ä»»åŠ¡19: å®ç°ç”¨æˆ·ç®¡ç†å‰ç«¯ï¼ˆç®¡ç†åå°ï¼‰
- ä»»åŠ¡20: å®ç°èµ„æºç®¡ç†APIï¼ˆç®¡ç†å‘˜ï¼‰
- ä»»åŠ¡21: å®ç°èµ„æºç®¡ç†å‰ç«¯ï¼ˆç®¡ç†åå°ï¼‰

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: æ‰€æœ‰ç®¡ç†å‘˜æ¥å£éƒ½éœ€è¦ç›¸åº”æƒé™
2. **æ“ä½œæ—¥å¿—**: æ‰€æœ‰ç®¡ç†æ“ä½œéƒ½ä¼šè®°å½•æ—¥å¿—
3. **æ•°æ®å®‰å…¨**: å¯†ç ä½¿ç”¨bcryptåŠ å¯†
4. **é˜²æŠ¤æªæ–½**: é˜²æ­¢ç®¡ç†å‘˜ç¦ç”¨è‡ªå·±
5. **æµ‹è¯•è´¦å·**: 
   - ç®¡ç†å‘˜: 13900000000 / test123456
   - æ™®é€šç”¨æˆ·: 13800000001 / test123456
   - VIPç”¨æˆ·: 13800000002 / test123456

## âœ¨ æ€»ç»“

ä»»åŠ¡18å·²æˆåŠŸå®Œæˆï¼Œå®ç°äº†å®Œæ•´çš„ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†APIï¼ŒåŒ…æ‹¬ï¼š
- âœ… 6ä¸ªæ ¸å¿ƒæ¥å£
- âœ… å®Œæ•´çš„æƒé™æ§åˆ¶
- âœ… æ“ä½œæ—¥å¿—è®°å½•
- âœ… æ•°æ®éªŒè¯å’Œå®‰å…¨
- âœ… 100%æµ‹è¯•é€šè¿‡ç‡

æ‰€æœ‰åŠŸèƒ½éƒ½ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼ğŸ‰
