# 需求文档：作品积分定价功能

## 简介

本需求文档定义了「作品积分定价功能」的完整需求，旨在解决当前系统中资源积分几乎为0的问题，建立完整的「上传-定价-下载-收益-兑换」积分闭环体系。

采用「系统限定框架 + 用户自主定价 + 审核兜底」的混合模式，该模式：
- 解决当前积分失效的核心问题
- 兼顾「平台规范统一」「创作者激励充足」「用户体验公平」三大目标
- 降低后续运营和系统改造的成本
- 平衡灵活性与可控性

## 术语表

- **Resource（资源）**: 用户上传的设计作品/素材资源
- **Pricing_Type（定价类型）**: 资源定价类型（0=免费资源，1=付费积分资源，2=VIP专属资源）
- **Points_Cost（积分价格）**: 下载该资源所需消耗的积分数量（用户自主设置，范围5-100）
- **Uploader（上传者）**: 资源上传者/创作者
- **Downloader（下载者）**: 资源下载者
- **VIP_User（VIP用户）**: 已开通VIP会员且在有效期内的用户
- **Normal_User（普通用户）**: 未开通VIP或VIP已过期的用户
- **Points_Balance（积分余额）**: 用户当前可用积分余额
- **Earnings（收益）**: 上传者因作品被下载获得的积分收益
- **Auditor（审核员）**: 平台审核员，负责审核资源内容和积分定价
- **Points_Exchange（积分兑换）**: 用户使用积分兑换平台权益的行为
- **Points_Expiry（积分有效期）**: 积分的有效使用期限，获取后12个月内有效
- **Risk_Control_Warning（风控预警）**: 系统检测到异常下载行为时触发的安全机制

## 需求列表

### 需求1：资源定价类型选择

**用户故事：** 作为上传者，我希望在上传资源时选择定价类型，以便控制我的作品如何分发和变现。

#### 验收标准

1. WHEN 上传者上传资源时，THE 上传页面 SHALL 显示三种定价类型选项：免费资源、付费积分资源、VIP专属资源
2. WHEN 上传者选择「免费资源」类型，THE 系统 SHALL 设置 pricing_type=0 且 points_cost=0，积分输入框不可见
3. WHEN 上传者选择「付费积分资源」类型，THE 系统 SHALL 设置 pricing_type=1 并显示积分设置输入框
4. WHEN 上传者选择「VIP专属资源」类型，THE 系统 SHALL 设置 pricing_type=2，积分输入框不可见
5. THE 系统 SHALL 在上传页面加载时默认选中「免费资源」类型
6. WHEN 上传者选择「批量上传」资源时，THE 系统 SHALL 提供「批量设置定价类型」功能：可统一设置所有批量资源为「免费/付费积分/VIP专属」，选择付费积分时可统一设置积分值（遵循5-100的5的倍数规则）

### 需求2：付费积分设置（系统限定框架）

**用户故事：** 作为上传者，我希望在系统限定的合理范围内自主设置积分价格，以便公平定价我的作品同时遵循平台规范。

#### 验收标准

1. WHEN 上传者选择「付费积分资源」类型，THE 积分输入框 SHALL 仅接受5到100之间的整数值（含边界）
2. WHEN 上传者输入小于5的值，THE 系统 SHALL 显示错误提示「积分不能低于5分」
3. WHEN 上传者输入大于100的值，THE 系统 SHALL 显示错误提示「积分不能超过100分」
4. THE 积分输入交互 SHALL 采用「下拉框+滑块」组合（下拉框含所有5的倍数预设值：5、10、15...100，滑块同步联动），禁止手动输入非预设值
5. WHEN 上传者通过滑块调整积分，THE 系统 SHALL 自动吸附到最近的5的倍数（如滑块拖动到7自动定位到5，拖动到8自动定位到10）
6. THE 下拉框和滑块 SHALL 实时同步当前选中的积分值，避免信息不一致

### 需求3：下载积分消耗逻辑

**用户故事：** 作为下载者，我希望在下载前清楚了解积分消耗规则，以便做出明智的积分使用决策。

#### 验收标准

1. WHEN 普通用户尝试下载免费资源（pricing_type=0），THE 系统 SHALL 允许直接下载，不扣除任何积分
2. WHEN 普通用户尝试下载付费积分资源（pricing_type=1），THE 系统 SHALL 从用户积分余额中扣除该资源的points_cost
3. WHEN 普通用户点击付费积分资源的「下载」按钮，THE 系统 SHALL 弹出二次确认弹窗（含「需扣除X积分，当前余额Y积分」提示），用户点击「确认」后再执行扣除和下载
4. WHEN 普通用户尝试下载付费积分资源 AND 积分余额 < points_cost，THE 系统 SHALL 阻止下载并显示「积分不足，还需X积分」，同时附加积分获取渠道入口（如「去上传作品赚积分」「查看积分任务」）
5. WHEN 普通用户尝试下载VIP专属资源（pricing_type=2），THE 系统 SHALL 阻止下载并显示「此资源为VIP专属，请开通VIP后下载」
6. WHEN VIP用户尝试下载任意资源（免费、付费积分、VIP专属），THE 系统 SHALL 允许直接下载，不扣除任何积分
7. WHEN 未登录用户浏览资源，THE 资源详情页 SHALL 显示定价类型，但隐藏「积分是否充足」提示，替换为「登录后查看积分余额」
8. WHEN VIP用户浏览付费积分/VIP专属资源，THE 系统 SHALL 在下载按钮旁显示「VIP专属免费」徽章，强化特权感知
9. THE 资源详情页 SHALL 在下载按钮前清晰显示定价类型和所需积分

### 需求4：上传者积分收益

**用户故事：** 作为上传者，我希望在我的资源被下载时获得积分收益，以便激励我持续创作和分享优质内容。

#### 验收标准

1. WHEN 免费资源被任意用户下载，THE 系统 SHALL 奖励上传者固定2积分
2. WHEN 付费积分资源被普通用户下载，THE 系统 SHALL 奖励上传者该资源points_cost的20%（最低2积分兜底）
3. WHEN 付费积分资源被VIP用户下载，THE 系统 SHALL 奖励上传者该资源points_cost的20%（最低2积分兜底），该收益由平台兜底承担，不向下载者额外收取任何积分
4. WHEN VIP专属资源被VIP用户下载，THE 系统 SHALL 奖励上传者固定10积分
5. THE 系统 SHALL 在points_records表中记录每笔收益交易，source='work_downloaded'
6. THE 系统 SHALL 在有效下载后立即更新上传者的points_balance和points_total
7. WHEN 上传者获得积分收益后，THE 系统 SHALL 发送站内信通知（含「您的作品《XXX》被下载，获得X积分收益，当前总余额Y积分」）

### 需求5：防作弊机制

**用户故事：** 作为平台运营者，我希望防止积分系统被滥用，以便保持积分经济的公平和可持续性。

#### 验收标准

1. WHEN 同一用户在24小时内多次下载同一资源，THE 系统 SHALL 仅奖励上传者1次收益
2. WHEN 同一用户在30天内下载同一资源超过3次，THE 系统 SHALL 不再奖励上传者任何额外收益
3. WHEN 上传者下载自己的资源，THE 系统 SHALL 不奖励任何收益
4. THE 系统 SHALL 记录所有下载尝试以供审计
5. THE 系统 SHALL 检测下载账号的关联性（如同一IP、同一设备、同一手机号关联的多个账号），若判定为「作弊账号集群」，则不向上传者发放该集群账号产生的任何收益
6. WHEN 单部作品24小时内被不同账号下载超过100次（且多为新注册账号），THE 系统 SHALL 自动触发风控预警，暂停该作品的收益发放，待运营审核后恢复
7. WHEN 系统触发风控预警后，THE 系统 SHALL 即时通知运营人员处理，审核时限不超过2个工作日
8. WHEN 运营审核完成（判定合规/作弊），THE 系统 SHALL 发送站内信通知上传者审核结果
9. IF 判定为合规下载，THE 系统 SHALL 恢复该作品的收益发放，并补发自预警以来的合法收益
10. IF 判定为作弊，THE 系统 SHALL 永久冻结该部分收益，且不向上传者发放

### 需求6：审核员积分调整

**用户故事：** 作为审核员，我希望在内容审核时调整不合理的积分定价，以便平台维持公平的定价标准。

#### 验收标准

1. WHEN 审核员审核资源时，THE 审核页面 SHALL 显示当前的pricing_type和points_cost
2. WHEN 审核员判定points_cost不合理，THE 审核员 SHALL 能够修改points_cost值
3. WHEN 审核员修改points_cost，THE 系统 SHALL 要求填写修改原因
4. WHEN 审核员修改points_cost，THE 系统 SHALL 限制修改值需符合「5-100且为5的倍数」规则，超出范围时提示「积分需为5-100的5的倍数」，且无法提交修改
5. WHEN 审核员修改points_cost，THE 系统 SHALL 通过站内信通知上传者，包含原值、新值和修改原因
6. THE 审核日志 SHALL 记录所有定价修改，包含auditor_id、original_value、new_value和reason

### 需求7：资源列表和详情页积分显示

**用户故事：** 作为浏览资源的用户，我希望清晰看到定价信息，以便快速识别免费、付费和VIP资源。

#### 验收标准

1. THE 资源卡片 SHALL 显示定价徽章：免费资源显示「免费」，付费资源显示「X积分」，VIP专属资源显示「VIP」
2. THE 资源详情页 SHALL 显示完整定价信息，包括pricing_type、points_cost和用户当前积分余额
3. WHEN 向已登录普通用户展示付费积分资源，THE 系统 SHALL 显示用户积分是否充足
4. THE 资源列表 SHALL 支持按pricing_type筛选（全部、免费、付费、VIP专属）

### 需求8：个人中心收益明细

**用户故事：** 作为上传者，我希望查看我的收益历史，以便追踪我上传资源的表现。

#### 验收标准

1. THE 个人中心 SHALL 显示「收益明细」板块，展示所有下载收益
2. WHEN 查看收益时，THE 系统 SHALL 显示：资源标题、下载时间、下载者类型（普通/VIP）、获得积分
3. THE 系统 SHALL 提供汇总统计：总收益、本月收益、总下载次数
4. THE 收益列表 SHALL 支持分页和日期范围筛选
5. THE 收益明细列表 SHALL 显示对应资源的跳转链接，方便上传者快速查看作品详情
6. THE 个人中心「我的作品」板块，每个作品的「编辑记录」中 SHALL 显示定价类型/积分的修改历史（含修改人、修改时间、原值、新值、修改原因），上传者可随时查看

### 需求9：数据库字段扩展

**用户故事：** 作为开发者，我希望数据库架构支持新的定价系统，以便所有定价数据能够正确存储和查询。

#### 验收标准

1. THE resources表 SHALL 新增字段：points_cost（INT类型，DEFAULT 0，范围0-100）
2. THE resources表 SHALL 新增字段：pricing_type（SMALLINT类型，DEFAULT 0，取值：0=免费，1=付费积分，2=VIP专属）
3. THE download_history表 SHALL 新增字段：earnings_awarded（BOOLEAN类型，DEFAULT false，记录该次下载是否产生了收益）
4. THE download_history表 SHALL 确保包含uploader_id和resource_id字段，便于后续收益对账和审计
5. THE 系统 SHALL 将现有资源迁移为pricing_type=0（免费）且points_cost=0
6. WHEN 现有资源迁移完成，THE 系统 SHALL 允许上传者在「我的作品」板块，对已通过审核的老资源修改定价类型和points_cost（修改后无需重新审核，仅记录变更日志）
7. THE 系统 SHALL 向所有上传者发送站内信，通知「老资源定价优化通道已开启，可调整为付费积分/VIP专属类型」

### 需求10：积分权益兑换

**用户故事：** 作为平台用户（上传者/下载者），我希望积分可兑换实际权益，以便提升积分的实际价值和使用动力。

#### 验收标准

1. THE 个人中心 SHALL 新增「积分兑换」板块，显示可兑换权益（如：VIP会员时长、平台周边礼品、创作工具会员等）
2. THE 系统 SHALL 明确每类权益的积分兑换比例（如：100积分=7天VIP、500积分=月度VIP）
3. WHEN 用户发起积分兑换，THE 系统 SHALL 先校验积分余额充足性，不足时显示「积分不足，无法兑换」
4. THE 系统 SHALL 在points_records表中记录兑换交易，source='points_exchange'
5. WHEN 兑换VIP会员成功，THE 系统 SHALL 即时激活用户VIP权限并同步有效期
6. WHEN 积分兑换VIP会员失败（系统异常导致未激活），THE 系统 SHALL 自动退回用户消耗的积分，并发送站内信告知
7. WHEN 兑换实物礼品后，因平台原因导致无法送达/礼品损坏，THE 系统 SHALL 提供「积分退回」或「重新寄送」二选一方案，由用户自主选择
8. THE 系统 SHALL 在「积分兑换」板块明确售后规则，避免用户争议
9. THE 系统 SHALL 生成积分兑换审计日志，包含兑换用户ID、兑换权益、消耗积分、兑换时间、兑换状态（成功/失败）、操作IP/设备信息，运营端可按日期范围筛选查询

### 需求11：积分有效期管理

**用户故事：** 作为平台运营者，我希望积分有合理的有效期，以便控制平台积分通胀风险，同时保障用户权益。

#### 验收标准

1. THE 系统 SHALL 设定积分有效期为「获取后12个月」，到期未使用的积分自动失效
2. THE 个人中心「积分余额」板块 SHALL 显示积分有效期提醒（如「当前可用积分XXX，其中XXX积分将于YYYY-MM-DD过期」）
3. WHEN 积分即将过期（到期前30天），THE 系统 SHALL 发送站内信提醒用户及时使用
4. THE 系统 SHALL 在积分失效时自动扣除过期积分，并在points_records表中记录，source='points_expired'

### 需求12：资源删除后的数据处理

**用户故事：** 作为平台运营者/开发者，我希望明确资源删除后的积分相关数据规则，以便保障数据完整性和用户权益。

#### 验收标准

1. WHEN 上传者删除已产生收益的资源，THE 系统 SHALL 保留该资源的下载记录和收益记录（不可删除），仅隐藏资源内容
2. THE 上传者的「收益明细」中仍可查看该资源的历史收益，但资源标题旁标注「已删除」
3. 已删除资源不再产生新的下载和收益，资源列表和搜索结果中不再展示
