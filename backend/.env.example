# ============================================
# 后端环境变量配置模板 (.env.example)
# ============================================
# 这是后端环境变量配置模板文件
# 使用说明：
# 1. 复制此文件为 .env（开发环境）或 .env.production（生产环境）
# 2. 根据实际情况修改配置项的值
# 3. 不要将包含敏感信息的 .env 文件提交到版本控制系统
# 4. 修改环境变量后需要重启后端服务

# ============================================
# 服务器配置
# ============================================

# 运行环境（development/production/staging）
# development: 开发环境，启用详细日志和调试功能
# production: 生产环境，优化性能和安全性
# staging: 预发布环境，用于测试
NODE_ENV=development

# 服务器监听端口
# 开发环境建议: 3000-9000之间的端口
# 生产环境建议: 80(HTTP)或443(HTTPS)，或使用Nginx反向代理
PORT=8080

# 服务器监听地址
# 0.0.0.0: 监听所有网络接口（推荐）
# 127.0.0.1: 仅监听本地回环接口（仅本机访问）
HOST=0.0.0.0

# ============================================
# 数据库配置
# ============================================

# PostgreSQL数据库连接URL
# 格式: postgresql://用户名:密码@主机:端口/数据库名?schema=模式名
# 示例: postgresql://postgres:mypassword@localhost:5432/startide_design?schema=public
# 
# 配置说明：
# - 用户名: PostgreSQL数据库用户名（默认postgres）
# - 密码: 数据库密码（请修改为强密码）
# - 主机: 数据库服务器地址（本地localhost，远程填写IP或域名）
# - 端口: PostgreSQL默认端口5432
# - 数据库名: 创建的数据库名称（建议startide_design）
# - schema: 数据库模式（默认public）
#
# 安全提示：
# - 生产环境必须使用强密码（至少16位，包含大小写字母、数字、特殊字符）
# - 不要使用默认密码
# - 建议使用专用数据库用户，不要使用postgres超级用户
DATABASE_URL="postgresql://postgres:password@localhost:5432/startide_design?schema=public"

# 数据库连接池配置（可选）
# 最大连接数（默认10）
DB_POOL_MAX=10

# 最小连接数（默认2）
DB_POOL_MIN=2

# 连接超时时间（毫秒，默认30000）
DB_POOL_TIMEOUT=30000

# ============================================
# JWT认证配置
# ============================================

# JWT密钥（用于签名和验证Token）
# 重要：生产环境必须修改为随机生成的强密钥
# 生成方法：node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# 或使用在线工具：https://www.grc.com/passwords.htm
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-use-at-least-64-characters

# Access Token过期时间
# 格式：数字+单位（s秒/m分钟/h小时/d天）
# 示例：7d（7天）、24h（24小时）、30m（30分钟）
# 建议：7d（普通用户）、1h（管理员）
JWT_EXPIRES_IN=7d

# Refresh Token过期时间
# 用于刷新Access Token，延长用户登录状态
# 建议：30d（30天）
JWT_REFRESH_EXPIRES_IN=30d

# Token刷新阈值（秒）
# 当Access Token剩余有效期小于此值时，自动刷新
# 建议：86400（1天）
JWT_REFRESH_THRESHOLD=86400

# ============================================
# Redis配置
# ============================================

# Redis服务器地址
# 本地开发: localhost
# 生产环境: Redis服务器IP或域名
REDIS_HOST=localhost

# Redis服务器端口（默认6379）
REDIS_PORT=6379

# Redis密码（如果设置了密码）
# 生产环境强烈建议设置密码
# 留空表示无密码
REDIS_PASSWORD=

# Redis数据库索引（0-15，默认0）
# 可以使用不同的数据库索引隔离不同环境的数据
REDIS_DB=0

# Redis连接超时时间（毫秒，默认10000）
REDIS_TIMEOUT=10000

# Redis键前缀（用于区分不同应用的数据）
REDIS_KEY_PREFIX=startide:

# ============================================
# 文件存储配置
# ============================================

# 文件上传目录（相对路径或绝对路径）
# 相对路径: ./uploads（相对于项目根目录）
# 绝对路径: /var/www/uploads（Linux）或 D:/uploads（Windows）
# 注意：确保目录存在且有写入权限
UPLOAD_DIR=./uploads

# 单个文件最大大小（字节）
# 1000MB = 1048576000字节
# 500MB = 524288000字节
# 100MB = 104857600字节
# 建议：根据服务器配置和用户需求设置
MAX_FILE_SIZE=1048576000

# 允许上传的文件类型（逗号分隔，包含点号）
# 设计文件: .psd,.ai,.cdr,.eps,.sketch,.xd,.fig
# 图片文件: .jpg,.jpeg,.png,.gif,.svg,.webp
# 文档文件: .pdf,.doc,.docx
ALLOWED_FILE_TYPES=.psd,.ai,.cdr,.eps,.pdf,.jpg,.jpeg,.png,.gif,.svg,.sketch,.xd,.fig

# 文件存储方式（local/oss）
# local: 本地存储（开发环境推荐）
# oss: 阿里云OSS存储（生产环境推荐）
FILE_STORAGE_TYPE=local

# 文件URL前缀（用于生成文件访问URL）
# 本地存储: http://localhost:8080/uploads
# OSS存储: https://your-bucket.oss-cn-hangzhou.aliyuncs.com
FILE_URL_PREFIX=http://localhost:8080/uploads

# ============================================
# 阿里云OSS配置（可选，仅在FILE_STORAGE_TYPE=oss时需要）
# ============================================

# OSS区域（如：oss-cn-hangzhou、oss-cn-beijing）
# 查看所有区域：https://help.aliyun.com/document_detail/31837.html
OSS_REGION=

# OSS访问密钥ID
# 获取方式：阿里云控制台 -> AccessKey管理
OSS_ACCESS_KEY_ID=

# OSS访问密钥Secret
# 重要：请妥善保管，不要泄露
OSS_ACCESS_KEY_SECRET=

# OSS存储桶名称
# 创建方式：阿里云控制台 -> 对象存储OSS -> 创建Bucket
OSS_BUCKET=

# OSS访问域名（可选）
# 默认域名: your-bucket.oss-cn-hangzhou.aliyuncs.com
# 自定义域名: cdn.yourdomain.com（需要在OSS控制台绑定）
OSS_ENDPOINT=

# OSS存储路径前缀（可选）
# 用于在Bucket中创建目录结构
# 示例：uploads/（所有文件存储在uploads目录下）
OSS_PATH_PREFIX=uploads/

# ============================================
# 微信支付配置
# ============================================

# 微信开放平台AppID
# 获取方式：https://open.weixin.qq.com/ -> 管理中心 -> 应用详情
# 注意：微信支付需要企业认证
WECHAT_APP_ID=

# 微信商户号
# 获取方式：https://pay.weixin.qq.com/ -> 产品中心 -> 开发配置
WECHAT_MCH_ID=

# 微信支付API密钥（V2版本）
# 获取方式：微信支付商户平台 -> 账户中心 -> API安全 -> 设置API密钥
# 注意：密钥长度32位，请妥善保管
WECHAT_API_KEY=

# 微信支付API密钥（V3版本，可选）
# V3版本使用证书方式，更安全
WECHAT_API_V3_KEY=

# 微信支付证书路径（V3版本需要）
# 下载方式：微信支付商户平台 -> 账户中心 -> API安全 -> 下载证书
# 证书文件：apiclient_cert.pem（公钥证书）
WECHAT_CERT_PATH=./certs/wechat/apiclient_cert.pem

# 微信支付私钥路径（V3版本需要）
# 证书文件：apiclient_key.pem（私钥）
WECHAT_KEY_PATH=./certs/wechat/apiclient_key.pem

# 微信支付回调地址
# 格式：https://yourdomain.com/api/v1/payment/wechat/callback
# 注意：必须是HTTPS，且需要在微信支付商户平台配置
WECHAT_NOTIFY_URL=https://yourdomain.com/api/v1/payment/wechat/callback

# ============================================
# 支付宝支付配置
# ============================================

# 支付宝应用AppID
# 获取方式：https://open.alipay.com/ -> 控制台 -> 应用列表
ALIPAY_APP_ID=

# 支付宝应用私钥（RSA2格式）
# 生成方式：使用支付宝提供的密钥生成工具
# 下载地址：https://opendocs.alipay.com/common/02kipl
# 注意：私钥格式为PKCS8，不要泄露
ALIPAY_PRIVATE_KEY=

# 支付宝公钥（RSA2格式）
# 获取方式：支付宝开放平台 -> 应用详情 -> 开发信息 -> 接口加签方式
# 注意：这是支付宝的公钥，不是应用公钥
ALIPAY_PUBLIC_KEY=

# 支付宝网关地址
# 正式环境: https://openapi.alipay.com/gateway.do
# 沙箱环境: https://openapi.alipaydev.com/gateway.do
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do

# 支付宝回调地址
# 格式：https://yourdomain.com/api/v1/payment/alipay/callback
# 注意：必须是HTTPS，且需要在支付宝开放平台配置
ALIPAY_NOTIFY_URL=https://yourdomain.com/api/v1/payment/alipay/callback

# 支付宝同步返回地址（可选）
# 用户支付完成后跳转的页面
ALIPAY_RETURN_URL=https://yourdomain.com/payment/success

# ============================================
# VIP支付系统配置
# ============================================

# 支付环境（sandbox/production）
# sandbox: 沙箱测试环境
# production: 正式生产环境
PAYMENT_ENV=sandbox

# 微信支付API V3密钥
WECHAT_PAY_API_KEY_V3=

# 微信支付证书序列号
WECHAT_PAY_CERT_SERIAL_NO=

# 微信支付平台证书路径
WECHAT_PAY_PLATFORM_CERT_PATH=./certs/wechat/wechatpay_cert.pem

# 二次验证阈值（分，默认20000分=200元）
# 订单金额大于等于此值时需要二次验证
SECONDARY_AUTH_THRESHOLD=20000

# 每小时最大未支付订单数
# 超过此数量将限制创建新订单
MAX_UNPAID_ORDERS_PER_HOUR=5

# 每用户最大登录设备数
MAX_DEVICES_PER_USER=3

# VIP用户每日下载上限
VIP_DAILY_DOWNLOAD_LIMIT=50

# 普通用户每日免费下载次数
FREE_DAILY_DOWNLOAD_LIMIT=2

# 订单超时时间（分钟）
ORDER_TIMEOUT_MINUTES=15

# 退款申请有效期（天）
# 购买后超过此天数不能申请退款
REFUND_VALID_DAYS=7

# 积分兑换VIP配置
# 每月VIP所需积分
POINTS_PER_VIP_MONTH=1000

# 单次最大兑换月数
MAX_EXCHANGE_MONTHS=3

# VIP宽限期（天）
# VIP到期后仍显示灰色图标的天数
VIP_GRACE_PERIOD_DAYS=7

# ============================================
# 短信服务配置（阿里云短信服务）
# ============================================

# 阿里云AccessKey ID
# 获取方式：阿里云控制台 -> AccessKey管理
SMS_ACCESS_KEY_ID=

# 阿里云AccessKey Secret
SMS_ACCESS_KEY_SECRET=

# 短信签名
# 创建方式：阿里云控制台 -> 短信服务 -> 国内消息 -> 签名管理
# 示例：星潮设计
SMS_SIGN_NAME=

# 短信模板CODE（验证码模板）
# 创建方式：阿里云控制台 -> 短信服务 -> 国内消息 -> 模板管理
# 模板示例：您的验证码是${code}，5分钟内有效
SMS_TEMPLATE_CODE=

# 短信验证码有效期（秒，默认300秒=5分钟）
SMS_CODE_EXPIRE=300

# 短信验证码长度（默认6位）
SMS_CODE_LENGTH=6

# 短信发送频率限制（秒，默认60秒）
# 同一手机号60秒内只能发送一次
SMS_RATE_LIMIT=60

# ============================================
# 邮件服务配置（SMTP）
# ============================================

# SMTP服务器地址
# QQ邮箱: smtp.qq.com
# 163邮箱: smtp.163.com
# Gmail: smtp.gmail.com
# 企业邮箱: 咨询邮件服务商
SMTP_HOST=smtp.example.com

# SMTP服务器端口
# SSL加密: 465
# TLS加密: 587
# 无加密: 25（不推荐）
SMTP_PORT=465

# 是否使用SSL加密（true/false）
# 端口465使用true，端口587使用false
SMTP_SECURE=true

# SMTP用户名（发件邮箱地址）
SMTP_USER=noreply@example.com

# SMTP密码（邮箱密码或授权码）
# 注意：QQ邮箱、163邮箱等需要使用授权码，不是登录密码
# 获取授权码：邮箱设置 -> 账户 -> POP3/SMTP服务 -> 生成授权码
SMTP_PASS=

# 发件人名称（显示在收件人邮箱中）
SMTP_FROM_NAME=星潮设计

# 邮件模板路径（可选）
EMAIL_TEMPLATE_DIR=./templates/email

# ============================================
# 日志配置
# ============================================

# 日志级别（error/warn/info/debug）
# error: 仅记录错误
# warn: 记录警告和错误
# info: 记录信息、警告和错误（推荐）
# debug: 记录所有日志（开发环境）
LOG_LEVEL=info

# 日志输出目录
# 相对路径: ./logs（相对于项目根目录）
# 绝对路径: /var/log/startide（Linux）
LOG_DIR=./logs

# 日志文件名前缀
LOG_FILE_PREFIX=app

# 日志文件最大大小（MB）
# 超过此大小自动切割日志文件
LOG_MAX_SIZE=10

# 日志文件保留天数
# 超过此天数的日志文件自动删除
LOG_MAX_DAYS=30

# 是否在控制台输出日志（true/false）
# 开发环境建议true，生产环境建议false
LOG_CONSOLE=true

# ============================================
# CORS跨域配置
# ============================================

# 允许跨域的源（多个用逗号分隔）
# 开发环境: http://localhost:5173,http://localhost:3000
# 生产环境: https://www.yourdomain.com,https://yourdomain.com
# 允许所有: *（不推荐，安全风险）
CORS_ORIGIN=http://localhost:5173

# 允许的HTTP方法（多个用逗号分隔）
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS

# 允许的请求头（多个用逗号分隔）
CORS_HEADERS=Content-Type,Authorization,X-Requested-With

# 是否允许携带凭证（Cookie）
CORS_CREDENTIALS=true

# 预检请求缓存时间（秒）
CORS_MAX_AGE=86400

# ============================================
# 限流配置
# ============================================

# 限流时间窗口（毫秒）
# 900000毫秒 = 15分钟
RATE_LIMIT_WINDOW_MS=900000

# 时间窗口内最大请求次数
# 建议：100-1000之间，根据服务器性能调整
RATE_LIMIT_MAX_REQUESTS=100

# 是否启用限流（true/false）
# 生产环境建议true，开发环境可以false
RATE_LIMIT_ENABLED=true

# 限流存储方式（memory/redis）
# memory: 内存存储（单机部署）
# redis: Redis存储（集群部署）
RATE_LIMIT_STORE=memory

# ============================================
# 系统配置
# ============================================

# 网站名称
SITE_NAME=星潮设计

# 网站URL（用于生成链接）
# 开发环境: http://localhost:5173
# 生产环境: https://www.yourdomain.com
SITE_URL=http://localhost:5173

# 管理员邮箱（用于接收系统通知）
ADMIN_EMAIL=admin@example.com

# 客服邮箱（用于用户联系）
SUPPORT_EMAIL=support@example.com

# 网站备案号（可选）
ICP_NUMBER=

# ============================================
# 审核模式配置
# ============================================

# 审核模式（production/development）
# production: 生产环境，执行完整审核流程（自动审核 → 人工审核）
# development: 开发环境，自动将 audit_status 设置为 1（审核通过）
# 默认值: production
AUDIT_MODE=production

# ============================================
# 安全配置
# ============================================

# 密码加密轮数（bcrypt）
# 建议：10-12之间，数值越大越安全但性能越低
PASSWORD_SALT_ROUNDS=10

# 会话密钥（用于加密Session）
# 生成方法：node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
SESSION_SECRET=your-session-secret-change-this-in-production

# CSRF Token密钥
CSRF_SECRET=your-csrf-secret-change-this-in-production

# 是否启用HTTPS（true/false）
# 生产环境建议true
ENABLE_HTTPS=false

# ============================================
# 性能优化配置
# ============================================

# 是否启用Gzip压缩（true/false）
ENABLE_GZIP=true

# 是否启用缓存（true/false）
ENABLE_CACHE=true

# 缓存过期时间（秒）
CACHE_TTL=3600

# 是否启用集群模式（true/false）
# 集群模式会启动多个进程，充分利用多核CPU
ENABLE_CLUSTER=false

# 集群进程数（0表示自动检测CPU核心数）
CLUSTER_WORKERS=0

# ============================================
# 监控和告警配置
# ============================================

# 是否启用性能监控（true/false）
ENABLE_MONITORING=true

# 监控数据上报地址（可选）
MONITORING_URL=

# 是否启用错误告警（true/false）
ENABLE_ERROR_ALERT=true

# 错误告警邮箱（多个用逗号分隔）
ERROR_ALERT_EMAILS=admin@example.com

# 错误告警阈值（每小时错误次数）
ERROR_ALERT_THRESHOLD=10

# ============================================
# 定时任务配置
# ============================================

# 是否启用定时任务（true/false）
ENABLE_CRON=true

# VIP到期检查时间（Cron表达式）
# 每天凌晨2点执行: 0 2 * * *
CRON_VIP_CHECK=0 2 * * *

# 数据库备份时间（Cron表达式）
# 每天凌晨3点执行: 0 3 * * *
CRON_DB_BACKUP=0 3 * * *

# 日志清理时间（Cron表达式）
# 每周日凌晨4点执行: 0 4 * * 0
CRON_LOG_CLEANUP=0 4 * * 0

# ============================================
# 开发调试配置
# ============================================

# 是否启用调试模式（true/false）
# 开发环境: true
# 生产环境: false
DEBUG=true

# 是否显示SQL查询日志（true/false）
DEBUG_SQL=false

# 是否显示详细错误信息（true/false）
# 开发环境: true（显示堆栈跟踪）
# 生产环境: false（仅显示错误消息）
DEBUG_ERROR=true

# ============================================
# 配置说明
# ============================================
#
# 1. 环境变量优先级：
#    - 系统环境变量 > .env.production > .env.development > .env
#    - 生产环境使用 .env.production
#    - 开发环境使用 .env.development
#
# 2. 敏感信息保护：
#    - 所有密钥、密码必须使用强随机字符串
#    - 不要将 .env 文件提交到Git仓库
#    - 在 .gitignore 中添加 .env*（保留.env.example）
#
# 3. 生产环境检查清单：
#    ✓ 修改所有默认密码和密钥
#    ✓ 启用HTTPS
#    ✓ 启用限流和CORS
#    ✓ 关闭调试模式
#    ✓ 配置日志轮转
#    ✓ 配置数据库备份
#    ✓ 配置错误告警
#
# 4. 常见问题：
#    Q: 修改环境变量后不生效？
#    A: 需要重启后端服务（npm run dev 或 pm2 restart）
#
#    Q: 数据库连接失败？
#    A: 检查DATABASE_URL格式、数据库是否启动、防火墙设置
#
#    Q: 文件上传失败？
#    A: 检查UPLOAD_DIR目录是否存在、是否有写入权限
#
#    Q: 支付回调失败？
#    A: 检查回调地址是否正确、是否使用HTTPS、是否在支付平台配置
#
# 5. 安全建议：
#    - 定期更换密钥和密码
#    - 使用环境变量管理工具（如dotenv-vault）
#    - 生产环境使用密钥管理服务（如AWS Secrets Manager）
#    - 限制数据库用户权限（不要使用root/postgres）
#    - 定期备份数据库和文件
#
# ============================================
