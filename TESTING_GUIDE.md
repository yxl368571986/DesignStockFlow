# 测试指南 - 个人中心和管理后台修复

## 服务状态
✅ 前端服务：http://localhost:3001/
✅ 后端服务：http://localhost:8080/

## 测试步骤

### 测试 1：管理员账号登录和后台访问

1. **登录管理员账号**
   - 访问：http://localhost:3001/
   - 使用最高权限账号登录
   - 观察登录响应中是否包含 `roleCode` 字段

2. **检查管理员入口**
   - 登录成功后，点击右上角用户头像
   - 下拉菜单中应该显示"管理后台"选项
   - 点击"管理后台"应该跳转到 `/admin` 页面

3. **验证权限检查**
   - 访问管理后台各个功能模块
   - 确认所有管理功能正常可用

### 测试 2：个人中心不自动退出

1. **访问个人中心**
   - 登录任意账号
   - 点击右上角用户头像 → "个人中心"
   - 或直接访问：http://localhost:3001/personal

2. **验证页面加载**
   - 页面应该正常加载，不会自动跳转到登录页
   - 即使某些 API 返回错误，也不应该触发登出
   - 检查浏览器控制台，确认没有 401 错误导致的登出

3. **检查各个标签页**
   - 我的下载：应该显示下载历史列表
   - 我的上传：应该显示上传的资源列表
   - 我的收藏：应该正常显示
   - VIP 信息：应该显示 VIP 状态和到期时间

### 测试 3：API 功能测试

#### 使用浏览器开发者工具或 Postman 测试

**获取上传历史**
```
GET http://localhost:8080/api/v1/user/upload-history?pageNum=1&pageSize=10
Headers:
  Authorization: Bearer <your_token>
```

预期响应：
```json
{
  "code": 200,
  "message": "获取上传历史成功",
  "data": {
    "list": [...],
    "total": 0,
    "pageNum": 1,
    "pageSize": 10,
    "totalPages": 0
  }
}
```

**获取 VIP 信息**
```
GET http://localhost:8080/api/v1/user/vip-info
Headers:
  Authorization: Bearer <your_token>
```

预期响应：
```json
{
  "code": 200,
  "message": "获取VIP信息成功",
  "data": {
    "vipLevel": 0,
    "vipExpireAt": null,
    "isVIP": false,
    "daysRemaining": 0
  }
}
```

### 测试 4：错误处理

1. **未登录访问**
   - 清除 token
   - 访问个人中心 API
   - 应该返回 401 错误，但前端应该跳转到登录页而不是崩溃

2. **无效参数**
   - 测试负数页码
   - 测试超大页码
   - 应该返回空列表或合理的错误信息

## 预期结果

### ✅ 成功标准
- 管理员账号登录后能看到"管理后台"入口
- 点击"管理后台"能正常访问 `/admin` 页面
- 访问个人中心不会自动退出
- 所有 API 返回正确的数据格式
- 错误情况下有合理的提示，不会导致应用崩溃

### ❌ 失败情况
- 管理员看不到"管理后台"入口 → 检查 `roleCode` 是否正确返回
- 访问个人中心自动退出 → 检查响应拦截器的错误处理
- API 返回 404 → 检查路由配置
- API 返回 500 → 检查后端日志，可能是数据库查询问题

## 调试技巧

### 前端调试
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签，观察 API 请求和响应
3. 查看 Console 标签，查看错误日志
4. 在 Application → Local Storage 中查看存储的 token 和用户信息

### 后端调试
1. 查看后端控制台输出
2. 检查日志文件：`backend/logs/`
3. 使用 Postman 或 curl 直接测试 API
4. 检查数据库中的数据是否正确

## 常见问题

**Q: 管理员入口不显示**
A: 检查用户信息中的 `roleCode` 字段，应该是 `super_admin`、`moderator` 或 `operator`

**Q: 个人中心还是会自动退出**
A: 检查 `src/utils/request.ts` 中的响应拦截器，确认错误处理逻辑

**Q: API 返回 401**
A: 检查 token 是否有效，是否正确设置在请求头中

**Q: 上传历史为空**
A: 检查数据库中 `resources` 表，确认 `user_id` 字段是否正确关联

## 下一步

测试完成后，如果发现问题：
1. 记录详细的错误信息（截图、日志、网络请求）
2. 检查相关代码文件
3. 根据错误类型进行针对性修复

如果测试通过：
1. 标记任务为完成
2. 更新项目文档
3. 考虑添加单元测试和集成测试
